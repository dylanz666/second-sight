<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>千里眼 - 远程桌面</title>
    <link rel="stylesheet" href="/static/styles.css?v=20250805-05">
    <script src="/static/index.js?v=20250805-05"></script>
</head>

<body>
    <div class="container">
        <div class="header">
            <h2>🖥️ 千里眼 - 远程桌面</h2>
        </div>

        <div class="main-content">
            <div class="screenshot-section">
                <!-- 单显示器容器 -->
                <div id="single-monitor-container" class="screenshot-container" style="display: none;">
                    <div id="screenshot-wrapper"
                        style="position: relative; display: flex; justify-content: center; align-items: center; width: 100%;">
                        <img id="screenshot" class="screenshot-image"
                            src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAwIiBoZWlnaHQ9IjYwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjhmOWZhIi8+PHRleHQgeD0iNDAwIiB5PSIzMDAiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxOCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+TG9hZGluZy4uLjwvdGV4dD48L3N2Zz4="
                            alt="Windows桌面截图">
                        <div id="loading-indicator" class="loading" style="position: absolute; display: none;"></div>
                    </div>
                </div>

                <!-- 多显示器容器 -->
                <div id="multi-monitor-container">
                    <div id="monitors-grid" class="monitors-grid">
                        <!-- 显示器截图将在这里动态生成 -->
                    </div>
                </div>

                <div class="controls">
                    <button class="btn btn-primary" onclick="toggleAutoRefresh()" id="autoRefreshBtn">🔄 自动刷新</button>
                    <button class="btn btn-success" onclick="refreshAllMonitors()">手动刷新</button>
                    <button class="btn btn-primary" onclick="reconnectServer()">重新连接</button>                    
                    <button class="btn btn-quality-settings" onclick="openQualitySettings()">⚙️ 质量设置</button>
                    <button class="btn btn-secondary" onclick="openCacheManager()">💾 缓存管理</button>
                    <button class="btn btn-warning" onclick="testSystemInfo()">系统信息</button>
                </div>
            </div>

            <div class="sidebar">
                <div class="status-card">
                    <h3 style="display: flex; align-items: center; justify-content: space-between;">
                        🔌 设备情况
                        <button class="btn btn-info"
                            style="margin-left: 130px; padding: 2px 14px; font-size: 13px; height: 28px; line-height: 1.2; border-radius: 6px; transition: background 0.2s, color 0.2s, box-shadow 0.2s; cursor: pointer;"
                            onclick="testNetwork()"
                            onmouseover="this.style.background='#17a2b8'; this.style.color='#fff'; this.style.boxShadow='0 2px 8px rgba(23,162,184,0.15)';"
                            onmouseout="this.style.background=''; this.style.color=''; this.style.boxShadow='';">刷新</button>
                    </h3>
                    <div class="status-item">
                        <span class="status-label">连接状态:</span>
                        <span class="status-value" id="server-status">
                            <span class="connection-indicator disconnected"></span>
                            未连接
                        </span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">内存使用:</span>
                        <div class="trend-chart-container">
                            <canvas id="memory-trend-chart" class="trend-chart" width="110" height="30"></canvas>
                            <span class="status-value" id="status-memory-usage">-</span>
                        </div>
                    </div>
                    <div class="status-item">
                        <span class="status-label">CPU使用:</span>
                        <div class="trend-chart-container">
                            <canvas id="cpu-trend-chart" class="trend-chart" width="110" height="30"></canvas>
                            <span class="status-value" id="status-cpu-usage">-</span>
                        </div>
                    </div>
                    <div class="status-item">
                        <span class="status-label">磁盘使用:</span>
                        <span class="status-value" id="status-disk-usage">-</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">网络状态:</span>
                        <span class="status-value" id="status-network-status">-</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">网络延迟:</span>
                        <div class="trend-chart-container">
                            <canvas id="network-latency-trend-chart" class="trend-chart" width="110"
                                height="30"></canvas>
                            <span class="status-value" id="status-network-latency">-</span>
                        </div>
                    </div>
                    <div class="status-item">
                        <span class="status-label">最后更新:</span>
                        <span class="status-value" id="last-update">-</span>
                    </div>
                </div>

                <!-- 文件管理卡片 -->
                <div class="status-card">
                    <h3 style="display: flex; align-items: center; justify-content: space-between;">
                        📁 文件管理
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div class="file-input-wrapper" style="display: flex; gap: 4px;">
                                <input type="file" id="fileInput" multiple
                                    accept=".txt,.pdf,.png,.jpg,.jpeg,.gif,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.zip,.rar,.7z"
                                    style="display: none;">
                                <input type="file" id="pathInput" style="display: none;">
                                <button class="btn btn-primary" id="pathBtn"
                                    style="padding: 2px 8px; font-size: 12px; height: 28px; line-height: 1.2; border-radius: 6px;"
                                    onclick="openPathModal()">
                                    设置路径
                                </button>
                                <button class="btn btn-success" onclick="handleFileUpload()" id="uploadBtn"
                                    style="padding: 2px 8px; font-size: 12px; height: 28px; line-height: 1.2; border-radius: 6px;">
                                    上传文件
                                </button>
                            </div>
                            <button class="btn btn-info"
                                style="padding: 2px 14px; font-size: 13px; height: 28px; line-height: 1.2; border-radius: 6px; transition: background 0.2s, color 0.2s, box-shadow 0.2s; cursor: pointer;"
                                onclick="loadFileList()"
                                onmouseover="this.style.background='#17a2b8'; this.style.color='#fff'; this.style.boxShadow='0 2px 8px rgba(23,162,184,0.15)';"
                                onmouseout="this.style.background=''; this.style.color=''; this.style.boxShadow='';">刷新</button>
                        </div>
                    </h3>
                    <div class="path-info" id="pathInfo"
                        style="display: none; margin-bottom: 8px; padding: 6px 8px; background: #f8f9fa; border-radius: 4px; font-size: 12px;">
                        <span style="font-weight: bold;">目标路径:</span>
                        <span id="currentPath" style="color: #007bff; word-break: break-all;"></span>
                    </div>
                    <div class="upload-info" id="uploadInfo" style="display: none; margin-bottom: 8px;">
                        <span id="selectedFilesCount">0</span> 个文件已选择
                    </div>
                    <div class="upload-progress" id="uploadProgress" style="display: none; margin-bottom: 8px;">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <div class="progress-text" id="progressText">0%</div>
                    </div>
                    <div id="fileList" class="file-list">
                        <div class="file-list-placeholder">点击刷新按钮加载文件列表</div>
                    </div>
                </div>

                <div class="status-card">
                    <h3>📝 系统日志</h3>
                    <div class="log-container" id="log-container">
                        <div class="log-entry info">[系统] 正在初始化...</div>
                    </div>
                </div>

                <!-- <div class="status-card">
                    <h3>💡 使用说明</h3>
                    <div style="font-size: 12px; line-height: 1.4;">
                        <p><strong>方式1：直接打开HTML文件</strong></p>
                        <p>1. 启动服务器：<code>python server.py</code></p>
                        <p>2. 双击打开 index.html</p>
                        <p>3. 页面会自动连接到 localhost:8000</p>
                        <br>
                        <p><strong>方式2：通过HTTP访问</strong></p>
                        <p>1. 启动服务器：<code>python server.py</code></p>
                        <p>2. 浏览器访问：<code>http://localhost:8000</code></p>
                        <br>
                        <p><strong>多显示器功能</strong></p>
                        <p>• 自动检测：自动识别系统中的所有显示器</p>
                        <p>• 分别显示：每个显示器独立显示，不拼接</p>
                        <p>• 主显示器：绿色边框标识主显示器</p>
                        <p>• 独立刷新：每个显示器可单独刷新</p>
                        <p>• 全屏查看：点击图片或全屏按钮查看</p>
                        <br>
                        <p><strong>系统监控功能</strong></p>
                        <p>• 实时状态：显示连接状态和系统资源</p>
                        <p>• 网络监控：实时检测网络连接质量</p>
                        <p>• 自动刷新：每2秒更新所有显示器截图</p>
                        <p>• 系统日志：记录所有操作和错误</p>
                    </div>
                </div> -->
            </div>
        </div>
    </div>

    <!-- 路径选择模态框 -->
    <div id="pathModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>📁 选择目标路径</h3>
                <button class="modal-close" onclick="closePathModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="current-path" id="modalCurrentPath">
                    <div class="path-input-wrapper">
                        <input type="text" id="modalCurrentPathInput" value="📂 Downloads" readonly>
                        <div class="copy-indicator">📋</div>
                    </div>
                </div>
                <div class="path-navigation">
                    <div class="path-actions">
                        <button class="btn btn-sm btn-outline-primary" onclick="navigateUp()" id="upButton">
                            ⬆️ 上级目录
                        </button>
                        <button class="btn btn-sm btn-outline-success" onclick="setDefaultPath()" id="defaultButton">
                            📁 默认目录
                        </button>
                        <button class="btn btn-sm btn-outline-info" onclick="handleNavigateToRoot()" id="rootButton">
                            🏠 我的电脑
                        </button>
                        <button class="btn btn-sm btn-outline-secondary" onclick="refreshPathList()">
                            🔄 刷新
                        </button>
                    </div>
                </div>
                <div class="path-list" id="modalPathList">
                    <div class="loading-placeholder">正在加载目录列表...</div>
                </div>
                <!-- Loading遮罩 -->
                <div id="modalLoadingOverlay" class="modal-loading-overlay" style="display: none;">
                    <div class="modal-loading-content">
                        <div class="loading-spinner"></div>
                        <div class="loading-text">正在加载...</div>
                    </div>
                </div>
            </div>
            <div class="modal-footer" style="display: flex; justify-content: space-between; align-items: center;">
                <div style="display: flex; justify-content: flex-start;">
                    <button class="btn btn-sm btn-outline-success" onclick="showCreateFolderDialog()"
                        id="createFolderButton">
                        📁 新建文件夹
                    </button>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-primary" onclick="selectCurrentPath()">确定</button>
                    <button class="btn btn-outline-secondary" onclick="closePathModal()">取消</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 创建文件夹对话框 -->
    <div id="createFolderModal" class="modal" style="display: none; z-index: 1001;">
        <div class="modal-content" id="createFolderModalContent" style="max-width: 400px;">
            <div class="modal-header">
                <h3>📁 创建新文件夹</h3>
                <button class="modal-close" onclick="closeCreateFolderDialog()">&times;</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 15px;">
                    <label for="folderNameInput"
                        style="display: block; margin-bottom: 5px; font-weight: bold;">文件夹名称:</label>
                    <input type="text" id="folderNameInput" placeholder="请输入文件夹名称"
                        style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">创建位置:</label>
                    <div id="createFolderLocation"
                        style="padding: 8px; background: #f8f9fa; border-radius: 4px; font-size: 12px; color: #666;">
                        正在获取当前位置...
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="createFolder()">创建</button>
                <button class="btn btn-outline-secondary" onclick="closeCreateFolderDialog()">取消</button>
            </div>
        </div>
    </div>

    <!-- 质量设置模态框 -->
    <div id="qualitySettingsModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3>⚙️ 截图质量设置</h3>
                <button class="modal-close" onclick="closeQualitySettings()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <h4>📏 图像尺寸设置</h4>
                    <div class="setting-group">
                        <label>单显示器最大宽度:</label>
                        <input type="number" id="singleMonitorWidth" min="800" max="2000" step="50">
                    </div>
                    <div class="setting-group">
                        <label>单显示器最大高度:</label>
                        <input type="number" id="singleMonitorHeight" min="600" max="1500" step="50">
                    </div>
                    <div class="setting-group">
                        <label>桌面截图最大宽度:</label>
                        <input type="number" id="desktopWidth" min="1200" max="2500" step="50">
                    </div>
                    <div class="setting-group">
                        <label>桌面截图最大高度:</label>
                        <input type="number" id="desktopHeight" min="800" max="1800" step="50">
                    </div>
                </div>

                <div class="settings-section">
                    <h4>🎨 图像质量设置</h4>
                    <div class="setting-group">
                        <label>图像格式:</label>
                        <select id="imageFormat">
                            <option value="jpeg">JPEG (较小文件，质量稍低)</option>
                            <option value="png">PNG (高质量，文件较大)</option>
                        </select>
                    </div>
                    <div class="setting-group">
                        <label>PNG质量 (1-100):</label>
                        <input type="range" id="pngQuality" min="1" max="100" step="1">
                        <span id="pngQualityValue">85</span>
                    </div>
                    <div class="setting-group">
                        <label>JPEG质量 (1-100):</label>
                        <input type="range" id="jpegQuality" min="1" max="100" step="1">
                        <span id="jpegQualityValue">80</span>
                    </div>
                    <div class="setting-group">
                        <label>PNG压缩级别 (0-9):</label>
                        <input type="range" id="compressionLevel" min="0" max="9" step="1">
                        <span id="compressionLevelValue">6</span>
                    </div>
                    <div class="setting-group">
                        <label>
                            <input type="checkbox" id="optimizePng"> 启用PNG优化
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="saveQualitySettings()">保存设置</button>
                <button class="btn btn-outline-secondary" onclick="closeQualitySettings()">取消</button>
            </div>
        </div>
    </div>

    <!-- 缓存管理模态框 -->
    <div id="cacheManagerModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3>💾 缓存管理</h3>
                <button class="modal-close" onclick="closeCacheManager()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="cache-stats">
                    <h4>📊 缓存统计</h4>
                    <div class="stat-item">
                        <span class="stat-label">当前缓存数量:</span>
                        <span class="stat-value" id="currentCacheSize">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">最大缓存数量:</span>
                        <span class="stat-value" id="maxCacheSizeDisplay">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">缓存命中率:</span>
                        <span class="stat-value" id="cacheHitRate">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">总请求数:</span>
                        <span class="stat-value" id="totalRequests">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">缓存命中数:</span>
                        <span class="stat-value" id="cacheHits">-</span>
                    </div>
                </div>

                <div class="cache-actions">
                    <h4>🔧 缓存操作</h4>
                    <button class="btn btn-warning" onclick="clearCache()">🗑️ 清除所有缓存</button>
                    <button class="btn btn-info" onclick="refreshCacheStats()">🔄 刷新统计</button>
                </div>

                <div class="cache-info">
                    <h4>ℹ️ 缓存说明</h4>
                    <p>• 缓存可以显著提高截图传输速度</p>
                    <p>• 相同设置的截图会被缓存，避免重复处理</p>
                    <p>• 缓存会自动清理过期和超量的项目</p>
                    <p>• 修改质量设置会自动清除缓存</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline-secondary" onclick="closeCacheManager()">关闭</button>
            </div>
        </div>
    </div>
</body>

</html>