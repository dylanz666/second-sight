<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Second Sight - Remote Desktop</title>
    <link rel="stylesheet" href="/static/styles.css?v=20250821-05">
    <!-- Modular JavaScript files -->
    <script src="/static/js/core.js?v=20250821-05"></script>
    <script src="/static/js/ui-utils.js?v=20250821-05"></script>
    <script src="/static/js/trend-charts.js?v=20250821-05"></script>
    <script src="/static/js/websocket.js?v=20250821-05"></script>
    <script src="/static/js/monitor.js?v=20250821-05"></script>
    <script src="/static/js/file-manager.js?v=20250821-05"></script>
    <script src="/static/js/file-manager-utils.js?v=20250821-05"></script>
    <script src="/static/js/settings.js?v=20250821-05"></script>
    <script src="/static/js/remote-control.js?v=20250821-05"></script>
    <script src="/static/js/main.js?v=20250821-05"></script>
</head>

<body>
    <div class="container">
        <div class="header">
            <h2>üñ•Ô∏è Second Sight - Remote Desktop</h2>
        </div>

        <div class="main-content">
            <div class="screenshot-section">
                <!-- Single monitor container -->
                <div id="single-monitor-container" class="screenshot-container" style="display: none;">
                    <div id="screenshot-wrapper"
                        style="position: relative; display: flex; justify-content: center; align-items: center; width: 100%;">
                        <img id="screenshot" class="screenshot-image"
                            src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAwIiBoZWlnaHQ9IjYwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjhmOWZhIi8+PHRleHQgeD0iNDAwIiB5PSIzMDAiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxOCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+TG9hZGluZy4uLjwvdGV4dD48L3N2Zz4="
                            alt="Windows Desktop Screenshot">
                        <div id="loading-indicator" class="loading" style="position: absolute; display: none;"></div>
                    </div>
                </div>

                <!-- Multi monitor container -->
                <div id="multi-monitor-container">
                    <div id="monitors-grid" class="monitors-grid">
                        <!-- Monitor screenshots will be generated here dynamically -->
                    </div>
                </div>

                <div class="controls">
                    <button class="btn btn-primary" onclick="toggleAutoRefresh()" id="autoRefreshBtn">üîÑ Auto Refresh</button>
                    <button class="btn btn-success" onclick="refreshAllMonitors()">Manual Refresh</button>
                    <button class="btn btn-primary" onclick="reconnectServer()">Reconnect</button>                    
                    <button class="btn btn-quality-settings" onclick="openQualitySettings()">‚öôÔ∏è Quality Settings</button>
                    <button class="btn btn-secondary" onclick="openCacheManager()">üíæ Cache Manager</button>
                    <button class="btn btn-warning" onclick="testSystemInfo()">System Info</button>
                    <button class="btn btn-info" onclick="toggleRemoteControl()" id="remoteControlBtn">üñ±Ô∏è Remote Control</button>
                </div>
            </div>

            <div class="sidebar">
                <div class="status-card">
                    <h3 style="display: flex; align-items: center; justify-content: space-between;">
                        üîå
                        <button class="btn btn-info"
                            style="margin-left: 130px; padding: 2px 14px; font-size: 13px; height: 28px; line-height: 1.2; border-radius: 6px; transition: background 0.2s, color 0.2s, box-shadow 0.2s; cursor: pointer;"
                            onclick="testNetwork()"
                            onmouseover="this.style.background='#17a2b8'; this.style.color='#fff'; this.style.boxShadow='0 2px 8px rgba(23,162,184,0.15)';"
                            onmouseout="this.style.background=''; this.style.color=''; this.style.boxShadow='';">Refresh</button>
                    </h3>
                    <div class="status-item">
                        <span class="status-label">Connection Status:</span>
                        <span class="status-value" id="server-status">
                            <span class="connection-indicator disconnected"></span>
                            Disconnected
                        </span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Memory:</span>
                        <div class="trend-chart-container">
                            <canvas id="memory-trend-chart" class="trend-chart" width="110" height="30"></canvas>
                            <span class="status-value" id="status-memory-usage">-</span>
                        </div>
                    </div>
                    <div class="status-item">
                        <span class="status-label">CPU:</span>
                        <div class="trend-chart-container">
                            <canvas id="cpu-trend-chart" class="trend-chart" width="110" height="30"></canvas>
                            <span class="status-value" id="status-cpu-usage">-</span>
                        </div>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Disk:</span>
                        <span class="status-value" id="status-disk-usage">-</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Network Status:</span>
                        <span class="status-value" id="status-network-status">-</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Network:</span>
                        <div class="trend-chart-container">
                            <canvas id="network-latency-trend-chart" class="trend-chart" width="110"
                                height="30"></canvas>
                            <span class="status-value" id="status-network-latency">-</span>
                        </div>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Last Update:</span>
                        <span class="status-value" id="last-update">-</span>
                    </div>
                </div>

                <!-- File Manager Card -->
                <div class="status-card">
                    <h3 style="display: flex; align-items: center; justify-content: space-between;">
                        üìÅ
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div class="file-input-wrapper" style="display: flex; gap: 4px;">
                                <input type="file" id="fileInput" multiple
                                    style="display: none;">
                                <input type="file" id="pathInput" style="display: none;">
                                <button class="btn btn-primary" id="pathBtn"
                                    style="padding: 2px 8px; font-size: 10px; height: 28px; line-height: 1.2; border-radius: 6px;"
                                    onclick="openPathModal()">
                                    Set Path
                                </button>
                                <button class="btn btn-success" onclick="handleFileUpload()" id="uploadBtn"
                                    style="padding: 2px 8px; font-size: 10px; height: 28px; line-height: 1.2; border-radius: 6px;">
                                    Upload File
                                </button>
                            </div>
                            <button class="btn btn-info"
                                style="padding: 2px 14px; font-size: 13px; height: 28px; line-height: 1.2; border-radius: 6px; transition: background 0.2s, color 0.2s, box-shadow 0.2s; cursor: pointer;"
                                onclick="loadFileList()"
                                onmouseover="this.style.background='#17a2b8'; this.style.color='#fff'; this.style.boxShadow='0 2px 8px rgba(23,162,184,0.15)';"
                                onmouseout="this.style.background=''; this.style.color=''; this.style.boxShadow='';">Refresh</button>
                        </div>
                    </h3>
                    <div class="path-info" id="pathInfo"
                        style="display: none; margin-bottom: 8px; padding: 6px 8px; background: #f8f9fa; border-radius: 4px; font-size: 12px;">
                        <span style="font-weight: bold;">Target Path:</span>
                        <span id="currentPath" style="color: #007bff; word-break: break-all;"></span>
                    </div>
                    <div class="upload-info" id="uploadInfo" style="display: none; margin-bottom: 8px;">
                        <span id="selectedFilesCount">0</span> files selected
                    </div>
                    <div class="upload-progress" id="uploadProgress" style="display: none; margin-bottom: 8px;">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <div class="progress-text" id="progressText">0%</div>
                    </div>
                    <div id="fileList" class="file-list">
                        <div class="file-list-placeholder">Click refresh to load file list</div>
                    </div>
                </div>

                <div class="status-card">
                    <h3>üìù System Log</h3>
                    <div class="log-container" id="log-container">
                        <div class="log-entry info">[System] Initializing...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Path Selection Modal -->
    <div id="pathModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üìÅ Select Target Path</h3>
                <button class="modal-close" onclick="closePathModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="current-path" id="modalCurrentPath">
                    <div class="path-input-wrapper">
                        <input type="text" id="modalCurrentPathInput" value="üìÇ Downloads" readonly>
                        <div class="copy-indicator">üìã</div>
                    </div>
                </div>
                <div class="path-navigation">
                    <div class="path-actions">
                        <button class="btn btn-sm btn-outline-primary" onclick="navigateUp()" id="upButton">
                            ‚¨ÜÔ∏è Up
                        </button>
                        <button class="btn btn-sm btn-outline-success" onclick="setDefaultPath()" id="defaultButton">
                            üìÅ Default Path
                        </button>
                        <button class="btn btn-sm btn-outline-info" onclick="handleNavigateToRoot()" id="rootButton">
                            üè† My Computer
                        </button>
                        <button class="btn btn-sm btn-outline-secondary" onclick="refreshPathList()">
                            üîÑ Refresh
                        </button>
                    </div>
                </div>
                <div class="path-list" id="modalPathList">
                    <div class="loading-placeholder">Loading directory list...</div>
                </div>
                <!-- Loading overlay -->
                <div id="modalLoadingOverlay" class="modal-loading-overlay" style="display: none;">
                    <div class="modal-loading-content">
                        <div class="loading-spinner"></div>
                        <div class="loading-text">Loading...</div>
                    </div>
                </div>
            </div>
            <div class="modal-footer" style="display: flex; justify-content: space-between; align-items: center;">
                <div style="display: flex; justify-content: flex-start;">
                    <button class="btn btn-sm btn-outline-success" onclick="showCreateFolderDialog()"
                        id="createFolderButton">
                        üìÅ New Folder
                    </button>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-primary" onclick="selectCurrentPath()">OK</button>
                    <button class="btn btn-outline-secondary" onclick="closePathModal()">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Folder Modal -->
    <div id="createFolderModal" class="modal" style="display: none; z-index: 1001;">
        <div class="modal-content" id="createFolderModalContent" style="max-width: 400px;">
            <div class="modal-header">
                <h3>üìÅ Create New Folder</h3>
                <button class="modal-close" onclick="closeCreateFolderDialog()">&times;</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 15px;">
                    <label for="folderNameInput"
                        style="display: block; margin-bottom: 5px; font-weight: bold;">Folder Name:</label>
                    <input type="text" id="folderNameInput" placeholder="Enter folder name"
                        style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Location:</label>
                    <div id="createFolderLocation"
                        style="padding: 8px; background: #f8f9fa; border-radius: 4px; font-size: 12px; color: #666;">
                        Getting current location...
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="createFolder()">Create</button>
                <button class="btn btn-outline-secondary" onclick="closeCreateFolderDialog()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Quality Settings Modal -->
    <div id="qualitySettingsModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3>‚öôÔ∏è Screenshot Quality Settings</h3>
                <button class="modal-close" onclick="closeQualitySettings()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <h4>üìè Image Size Settings</h4>
                    <div class="setting-group">
                        <label>Single Monitor Max Width:</label>
                        <input type="number" id="singleMonitorWidth" min="800" max="2000" step="50">
                    </div>
                    <div class="setting-group">
                        <label>Single Monitor Max Height:</label>
                        <input type="number" id="singleMonitorHeight" min="600" max="1500" step="50">
                    </div>
                    <div class="setting-group">
                        <label>Desktop Screenshot Max Width:</label>
                        <input type="number" id="desktopWidth" min="1200" max="2500" step="50">
                    </div>
                    <div class="setting-group">
                        <label>Desktop Screenshot Max Height:</label>
                        <input type="number" id="desktopHeight" min="800" max="1800" step="50">
                    </div>
                </div>

                <div class="settings-section">
                    <h4>üé® Image Quality Settings</h4>
                    <div class="setting-group">
                        <label>Image Format:</label>
                        <select id="imageFormat">
                            <option value="jpeg">JPEG (smaller file, lower quality)</option>
                            <option value="png">PNG (high quality, larger file)</option>
                        </select>
                    </div>
                    <div class="setting-group">
                        <label>PNG Quality (1-100):</label>
                        <input type="range" id="pngQuality" min="1" max="100" step="1">
                        <span id="pngQualityValue">60</span>
                    </div>
                    <div class="setting-group">
                        <label>JPEG Quality (1-100):</label>
                        <input type="range" id="jpegQuality" min="1" max="100" step="1">
                        <span id="jpegQualityValue">60</span>
                    </div>
                    <div class="setting-group">
                        <label>PNG Compression Level (0-9):</label>
                        <input type="range" id="compressionLevel" min="0" max="9" step="1">
                        <span id="compressionLevelValue">6</span>
                    </div>
                    <div class="setting-group">
                        <label>
                            <input type="checkbox" id="optimizePng"> Enable PNG Optimization
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="saveQualitySettings()">Save Settings</button>
                <button class="btn btn-outline-secondary" onclick="closeQualitySettings()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Cache Manager Modal -->
    <div id="cacheManagerModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3>üíæ Cache Manager</h3>
                <button class="modal-close" onclick="closeCacheManager()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="cache-stats">
                    <h4>üìä Cache Stats</h4>
                    <div class="stat-item">
                        <span class="stat-label">Current Cache Size:</span>
                        <span class="stat-value" id="currentCacheSize">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Max Cache Size:</span>
                        <span class="stat-value" id="maxCacheSizeDisplay">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Cache Hit Rate:</span>
                        <span class="stat-value" id="cacheHitRate">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Total Requests:</span>
                        <span class="stat-value" id="totalRequests">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Cache Hits:</span>
                        <span class="stat-value" id="cacheHits">-</span>
                    </div>
                </div>

                <div class="cache-actions">
                    <h4>üîß Cache Actions</h4>
                    <button class="btn btn-warning" onclick="clearCache()">üóëÔ∏è Clear All Cache</button>
                    <button class="btn btn-info" onclick="refreshCacheStats()">üîÑ Refresh Stats</button>
                </div>

                <div class="cache-info">
                    <h4>‚ÑπÔ∏è Cache Info</h4>
                    <p>‚Ä¢ Cache can significantly improve screenshot transfer speed</p>
                    <p>‚Ä¢ Screenshots with the same settings will be cached to avoid repeated processing</p>
                    <p>‚Ä¢ Cache will automatically clean up expired and excessive items</p>
                    <p>‚Ä¢ Changing quality settings will automatically clear the cache</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline-secondary" onclick="closeCacheManager()">Close</button>
            </div>
        </div>
    </div>

    <!-- Remote Control Panel -->
    <div id="remoteControlPanel" class="remote-control-panel" style="display: none;">
        <div class="remote-control-header">
            <h3>üñ±Ô∏è Remote Control</h3>
            <button class="remote-control-close" onclick="toggleRemoteControl()">&times;</button>
        </div>
        <div class="remote-control-body">
            <div class="control-section">
                <h4>üìù Text Input</h4>
                <div class="input-group">
                    <input type="text" id="remoteTextInput" placeholder="Enter text to send..." style="width: 200px;">
                    <button class="btn btn-primary" onclick="sendRemoteText()">Send</button>
                </div>
            </div>
            
            <div class="control-section">
                <h4>‚å®Ô∏è Common Keys</h4>
                <div class="key-buttons">
                    <button class="btn btn-sm btn-secondary" onclick="sendRemoteKey('enter')">Enter</button>
                    <button class="btn btn-sm btn-secondary" onclick="sendRemoteKey('tab')">Tab</button>
                    <button class="btn btn-sm btn-secondary" onclick="sendRemoteKey('space')">Space</button>
                    <button class="btn btn-sm btn-secondary" onclick="sendRemoteKey('backspace')">Backspace</button>
                    <button class="btn btn-sm btn-secondary" onclick="sendRemoteKey('delete')">Delete</button>
                    <button class="btn btn-sm btn-secondary" onclick="sendRemoteKey('escape')">Esc</button>
                </div>
                <div class="key-buttons" style="margin-top: 8px;">
                    <button class="btn btn-sm btn-secondary" onclick="sendRemoteKey('arrowup')">‚Üë</button>
                    <button class="btn btn-sm btn-secondary" onclick="sendRemoteKey('arrowdown')">‚Üì</button>
                    <button class="btn btn-sm btn-secondary" onclick="sendRemoteKey('arrowleft')">‚Üê</button>
                    <button class="btn btn-sm btn-secondary" onclick="sendRemoteKey('arrowright')">‚Üí</button>
                </div>
            </div>
            
            <div class="control-section">
                <h4>üîß Hotkeys</h4>
                <div class="hotkey-buttons">
                    <button class="btn btn-sm btn-warning" onclick="sendRemoteHotkey(['ctrl', 'c'])">Ctrl+C</button>
                    <button class="btn btn-sm btn-warning" onclick="sendRemoteHotkey(['ctrl', 'v'])">Ctrl+V</button>
                    <button class="btn btn-sm btn-warning" onclick="sendRemoteHotkey(['ctrl', 'a'])">Ctrl+A</button>
                    <button class="btn btn-sm btn-warning" onclick="sendRemoteHotkey(['ctrl', 'z'])">Ctrl+Z</button>
                    <button class="btn btn-sm btn-warning" onclick="sendRemoteHotkey(['alt', 'tab'])">Alt+Tab</button>
                    <button class="btn btn-sm btn-warning" onclick="sendRemoteHotkey(['win', 'd'])">Win+D</button>
                </div>
            </div>
            
            <div class="control-section">
                <h4>‚ÑπÔ∏è Instructions</h4>
                <div class="control-info">
                    <p>‚Ä¢ Click anywhere on the screenshot to perform a mouse click</p>
                    <p>‚Ä¢ Double-click the screenshot for double-click operation</p>
                    <p>‚Ä¢ Right-click the screenshot for right-click operation</p>
                    <p>‚Ä¢ Drag the screenshot to select</p>
                    <p>‚Ä¢ Use the mouse wheel to scroll on the screenshot</p>
                    <p>‚Ä¢ Enter text in the input box and click send</p>
                </div>
            </div>
        </div>
    </div>
</body>

</html>